CREATE DATABASE QUANLYDIEMSV
GO

USE QUANLYDIEMSV

GO

---TAO BANG CHO CSDL
CREATE TABLE DMKHOA (
	MAKHOA CHAR(2) PRIMARY KEY NOT NULL,
	TENKHOA NVARCHAR(30) NOT NULL,
);

GO

CREATE TABLE DMSV (
	MASV CHAR(3) PRIMARY KEY NOT NULL,
	HOSV NVARCHAR(30) NOT NULL,
	TENSV NVARCHAR(20) NOT NULL,
	PHAI INT ,
	NGAYSINH DATETIME,
	NOISINH NVARCHAR(25), 
	MAKHOA CHAR(2) NOT NULL,
	CONSTRAINT RB_MAKHOA FOREIGN KEY (MAKHOA) REFERENCES DMKHOA(MAKHOA),
	HOCBONG FLOAT, 
);

GO

CREATE TABLE DMMH (
	MAMH CHAR(2) PRIMARY KEY NOT NULL, 
	TENMH NVARCHAR(30) NOT NULL, 
	SOTIET INT, 
); 
GO

CREATE TABLE KETQUA (
	MASV CHAR(3), 
	MAMH CHAR(2), 
	LANTHI INT, 
	CONSTRAINT RB_SV_MH_KQ PRIMARY KEY (MASV, MAMH, LANTHI), 
	CONSTRAINT RB_MASV FOREIGN KEY(MASV) REFERENCES DMSV(MASV), 
	CONSTRAINT RB_MAMH FOREIGN KEY(MAMH) REFERENCES DMMH(MAMH),
	DIEM DECIMAL(4,2),
);

GO

---NHAP DU LIEU VAO BANG
----BANG DMMH
INSERT INTO DMMH VALUES('01', N'Cơ sở dữ liệu', '45');
INSERT INTO DMMH VALUES('02', N'Trí tuệ nhân tạo', '45');
INSERT INTO DMMH VALUES('03', N'Truyền tin', '45');
INSERT INTO DMMH VALUES('04', N'Đồ họa', '60');
INSERT INTO DMMH VALUES('05', N'Văn phạm', '60');
INSERT INTO DMMH VALUES('06', N'Kỹ thuật lập trình', '45');

----BANG DMKHOA
INSERT INTO DMKHOA VALUES('AV', N'Anh Văn');
INSERT INTO DMKHOA VALUES('TH', N'Tin Học');
INSERT INTO DMKHOA VALUES('TR', N'Triết');
INSERT INTO DMKHOA VALUES('VL', N'Vật Lý');

----BANG DMSV
INSERT INTO DMSV VALUES('A01', N'Nguyễn thị', N'Hải', '1', '02/23/1993', N'Hà Nội', 'TH', '130000');
INSERT INTO DMSV VALUES('A02', N'Trần văn', N'Chính', '0', '12/24/1992', N'Bình Định', 'VL', '150000');
INSERT INTO DMSV VALUES('A03', N'Lê thu bạch', N'Yến', '1', '02/21/1993', N'TP HCM', 'TH', '170000');
INSERT INTO DMSV VALUES('A04', N'Trần anh', N'Tuấn', '0', '12/20/1994', N'Hà Nội', 'AV', '80000');
INSERT INTO DMSV VALUES('B01', N'Trần thanh', N'Mai', '1', '08/12/1993', N'Hải Phòng', 'TR', '0');
INSERT INTO DMSV VALUES('B02', N'Trần thị thu', N'Thủy', '1', '01/02/1994', N'TP HCM', 'AV', '0');

----BANG KETQUA
INSERT INTO KETQUA VALUES('A01', '01', '1', '3.00');
INSERT INTO KETQUA VALUES('A01', '01', '2', '6.00');
INSERT INTO KETQUA VALUES('A01', '02', '2', '6.00');
INSERT INTO KETQUA VALUES('A01', '03', '1', '5.00');

INSERT INTO KETQUA VALUES('A02', '01', '1', '4.5');
INSERT INTO KETQUA VALUES('A02', '01', '2', '7.00');
INSERT INTO KETQUA VALUES('A02', '03', '1', '10.00');
INSERT INTO KETQUA VALUES('A02', '05', '1', '9.00');

INSERT INTO KETQUA VALUES('A03', '01', '1', '2.00');
INSERT INTO KETQUA VALUES('A03', '01', '2', '5.00');
INSERT INTO KETQUA VALUES('A03', '03', '1', '2.5');
INSERT INTO KETQUA VALUES('A03', '03', '2', '4.00');

INSERT INTO KETQUA VALUES('A04', '05', '2', '10.00');

INSERT INTO KETQUA VALUES('B01', '01', '1', '7.00');
INSERT INTO KETQUA VALUES('B01', '03', '1', '2.5');
INSERT INTO KETQUA VALUES('B01', '03', '2', '5.00');

INSERT INTO KETQUA VALUES('B02', '02', '1', '6.00');
INSERT INTO KETQUA VALUES('B02', '04', '1', '10.00');
GO

---TRUY VAN DU LIEU
----1.1
SELECT MAMH AS 'Mã-môn', TENMH AS 'Tên-môn', SOTIET as 'Số_tiết'
FROM DMMH
WHERE TENMH LIKE N'%N'

----1.2
SELECT MASV, HOSV, TENSV, PHAI, HOCBONG
FROM DMSV
WHERE TENSV LIKE N'%[V-Z]%'

----1.3
SELECT MASV, HOSV, TENSV, NOISINH, HOCBONG
FROM DMSV
WHERE HOCBONG >=120000 AND NOISINH = N'Hà Nội'

----1.4
SELECT S.MASV, S.HOSV, S.TENSV, S.NGAYSINH, DMKHOA.TENKHOA
FROM DMSV AS S, DMKHOA
WHERE S.MAKHOA = DMKHOA.MAKHOA AND NGAYSINH BETWEEN '1992-01-01' AND '1993-06-05'

----1.5
SELECT S.MASV, S.HOSV, S.TENSV, S.NGAYSINH, S.PHAI, K.TENKHOA
FROM DMSV AS S, DMKHOA AS K
WHERE S.MAKHOA = K.MAKHOA AND S.HOCBONG >=80000 AND S.HOCBONG <=180000 AND S.PHAI = 0

----1.6
SELECT S.MASV, S.HOSV +' '+S.TENSV AS HOTEN, K.TENKHOA, S.PHAI
FROM DMSV AS S, DMKHOA AS K
WHERE S.PHAI = 1 AND S.MAKHOA = K.MAKHOA AND (K.TENKHOA = N'Anh Văn' OR K.TENKHOA = N'Tin Học')

----1.7
SELECT S.MASV, S.HOSV +' '+S.TENSV AS HOTEN, S.PHAI, KQ.LANTHI, KQ.DIEM, M.TENMH
FROM DMSV AS S, KETQUA AS KQ, DMMH AS M
WHERE S.MASV = KQ.MASV AND M.MAMH = KQ.MAMH AND M.TENMH = N'Cơ sở dữ liệu' AND KQ.LANTHI = 1
AND KQ.DIEM < 5

----1.8
SELECT S.MASV, S.HOSV +' '+S.TENSV AS HOTEN, K.TENKHOA, S.NOISINH, S.HOCBONG
FROM DMSV AS S, DMKHOA AS K
WHERE S.MAKHOA = K.MAKHOA AND K.TENKHOA = N'Anh Văn' AND S.HOCBONG <=0